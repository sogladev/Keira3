<div class="container-fluid">
  <div class="content-block">
    <div class="row">
      <div class="col-12">
        <h4>{{ 'COPY_OUTPUT.TITLE' | translate }}</h4>
        <p>{{ 'COPY_OUTPUT.DESCRIPTION' | translate }}</p>
      </div>
    </div>

    @if (error()) {
      <keira-query-error [error]="error()!" />
    }

    @if (relatedTableStates().length > 0) {
      <div class="row mb-3">
        <div class="col-12">
          <div class="mb-2 d-flex align-items-center">
            <button class="btn btn-primary btn-sm me-2" type="button" (click)="selectAllRelated(true)">
              <i class="fa fa-check fa-sm"></i> {{ 'COPY_OUTPUT.SELECT_ALL' | translate }}
            </button>
            <button class="btn btn-primary btn-sm me-2" type="button" (click)="selectAllRelated(false)">
              <i class="fa fa-times fa-sm"></i> {{ 'COPY_OUTPUT.SELECT_NONE' | translate }}
            </button>
          </div>

          <div class="related-tables-list mb-2">
            @for (r of relatedTableStates(); track r.tableName) {
              <label class="me-3">
                <input type="checkbox" [checked]="r.included" (change)="toggleRelatedTable(r.tableName)" />
                {{ r.tableName }} ({{ r.count }})
              </label>
            }
          </div>
        </div>
      </div>
    }

    <div class="row">
      <div class="col-12">
        <div class="sql-output-container mb-3">
          <keira-highlightjs-wrapper [code]="copyQuery()" />
        </div>
        <button
          id="copy-btn"
          class="btn btn-secondary btn-sm me-2"
          (click)="copy()"
          type="button"
          [tooltip]="'COPY_OUTPUT.COPY_TOOLTIP' | translate"
          placement="top"
        >
          <i class="fa fa-copy fa-sm"></i> {{ 'COPY_OUTPUT.COPY' | translate }}
        </button>

        <button
          id="execute-btn"
          class="btn btn-primary btn-sm me-2"
          (click)="execute()"
          type="button"
          [disabled]="executing() || executed()"
          [tooltip]="'COPY_OUTPUT.EXECUTE_TOOLTIP' | translate"
          placement="top"
        >
          <i class="fa fa-bolt fa-sm"></i>
          @if (executing()) {
            <i class="fas fa-spinner fa-spin"></i>
          }
          {{ executed() ? ('COPY_OUTPUT.EXECUTED' | translate) : ('COPY_OUTPUT.EXECUTE' | translate) }}
        </button>

        <button
          class="btn btn-success btn-sm"
          (click)="continue()"
          type="button"
          [disabled]="!executed()"
          [tooltip]="'COPY_OUTPUT.CONTINUE_TOOLTIP' | translate"
          placement="top"
        >
          <i class="fa fa-arrow-right fa-sm"></i> {{ 'COPY_OUTPUT.CONTINUE' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
